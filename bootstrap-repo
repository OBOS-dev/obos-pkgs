#1/usr/bin/bash
if [[ -e obos-strap-dir && ! -d obos-strap-dir ]]
then
    rm obos-strap-dir
fi
if [ ! -e obos-strap-dir ]
then
    git clone https://github.com/OBOS-dev/obos-strap obos-strap-dir --depth=1 --recurse-submodules
else
    git -C obos-strap-dir pull
fi  
cd obos-strap-dir
cmake -Bbuild -DCMAKE_BUILD_TYPE=RelWithDebInfo
cmake --build build
if test -f out/obos-strap 
then
    cp out/obos-strap ../
elif test -f out/obos-strap.exe
then
    cp out/obos-strap.exe ../
fi

cd ..

if [[ ! -f ./settings.json ]] then
    arch=$1
    if (( $# == 0 ))
    then
        arch=x86_64
    fi
    echo Setting up settings.json for $arch
    cp settings-$arch.json settings.json
fi 
