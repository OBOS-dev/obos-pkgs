{
    "name": "oboskrnl",
    "description": "OBOS kernel and drivers",
    "version": [],
    "git-url": "https://github.com/OBOS-dev/obos",
    "git-commit": "master",
    "depends": [ "cross-gcc", "bootstrap-binutils" ],
    "patches": [],
    "bootstrap-commands": [
       [
            "${root_directory}/scripts/obos-configure.sh",
            "${target_triplet}", "${repo_directory}/obos/"
       ]
    ],
    "build-commands": [
        [ "mkdir", "-p", "tar" ],
        [ "mkdir", "-p", "tar/mnt" ],
        [ "mkdir", "-p", "tar/dev" ],
        [ "${root_directory}/scripts/generate-initrd.sh", "${repo_directory}", "${bootstrap_directory}" ],
        [ "cmake", "--build", "." ],
        [ "bash", "-c", "cp ${repo_directory}/obos/out/uart tar/ 2>/dev/null || :" ],
        [ "cp", "${repo_directory}/obos/out/ahci", "tar/" ],
        [ "cp", "${repo_directory}/obos/out/slowfat", "tar/" ],
        [ "cp", "${repo_directory}/obos/out/r8169", "tar/" ],
        [ "bash", "-c", "cp ${repo_directory}/obos/out/bochs_vbe tar/ 2>/dev/null || :" ],
        [ "cp", "${repo_directory}/obos/out/libps2", "tar/" ],
        [ "bash", "-c", "cp ${repo_directory}/obos/out/i8042 tar/ 2>/dev/null || :" ],
        [ "cp", "${repo_directory}/obos/out/extfs", "tar/" ],
        [ "${root_directory}/scripts/generate-initrd.sh", "${repo_directory}", "${bootstrap_directory}" ],
        [ "cmake", "--build", "." ]
    ],
    "run-commands": [
        [ "qemu-system-x86_64",
          "-drive", "format=raw,file=obos.iso",
          "-M", "q35",
          "-m", "2G",
          "-enable-kvm", "-cpu", "host",
          "-debugcon", "file:/dev/stdout", "-monitor", "stdio",
          "-smp", "4", "-s",
          "-bios", "/usr/share/ovmf/OVMF.fd",
          "-audio", "driver=sdl,model=hda"
         ]
    ],
    "install-commands": [
        [ "cd", "${repo_directory}/obos/out" ],
        [ "bash", "-c", "cp fork-test klog-level mem-usage mkswap mount obos-gettime powerctl swapon sync-anon umount ${prefix}/bin 2>/dev/null || :" ],
        [ "cp", "init", "${prefix}/../distro-files/" ],
        [ "cd", "${bootstrap_directory}/oboskrnl" ],
        [ "bash", "-c", "cp ${repo_directory}/obos/out/obos.iso ${bootstrap_directory}/../ 2>/dev/null || :" ]
    ]
}
